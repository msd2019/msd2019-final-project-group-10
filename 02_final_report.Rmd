---
title: "MSD 2019 Final Project"
subtitle: "A replication and extension of Chilling Effects: Online Surveillance and Wikipedia Use by Jonathon W. Penney, Berkeley Technology Law Journal"
author: "Thanaspakorn Niyomkarn, Alex Li Kong, and Sang Won Lee (tn2381, alk2225, and sl4447)"
date: '`r Sys.time()`'
output:
  pdf_document:
    toc: yes
    toc_depth: 3
---

```{r setup, include=FALSE}
library(scales)
library(tidyverse)
library(lubridate)
library(wikipediatrend)

theme_set(theme_bw())

knitr::opts_chunk$set(echo = TRUE)
```

# 1. Introduction

This Rmd file attempts to replicate and extend the results in Chilling Effects: Online Surveillance and Wikipedia Use by Jonathon W. Penney in Berkeley Technology Law Journal. The author is a research fellow at University of Toronto. This single author paper has H5-index of 21. This paper is about the NSA/PRISM surveillance 2007, where United States National Security Agency (NSA) started collecting Internet communications from various US Internet companies. This information was made public in 2013 by Edward Snowden revelations. This paper deals with the NSA paranoia where the paper studies traffic to Wikipedia articles on topics that raise privacy concerns for Wikipedia users before and after the Edward Snowden revelations. The Wikipedia traffic was chosen because over 50% of Internet users use Wikipedia as a source of information. Over 1/3 of Americans annually access Wikipedia as a source of information and is in top 10 of most popular sites on the internet.

# 2. Reproducing the Original Study

Our group decide to reproduce the main analysis of the study which is the study about the discontinuity of the trend of views on Wikipedia articles. Although the data is time series, linear regression is a good way to capture the trend since our main goal is not predicting the exact number of views. The linear model used in the study is:
$$Y_t = \beta_0 + \beta_1 time + \beta_2 intervention + \beta_3 postslope$$
The model can be interpret as an ordinary regression for data at the time before the revelation of the surveilance in June 2013. For the data after the incident, an interaction is added to both intercept and slope, 0 if data is before and 1 for after. 'Intervention' or change in level is the binary value multiply with a weight which indicates the changing intercept after the event. 'Postslope' or change in slope is the binary value multiply with time indicating change in trend. 

## 2.1 Data

The study uses a list of keywords the U.S. Department of Homeland Security uses to track and monitor social media. Keyword selection and ranking are done using a survey on Amazon’s Mechanical Turk (MTurk) asking their opinions about topics on ‘Government trouble’, ‘Browser delete’, ‘Privacy sensitive’, ‘Avoidance’. Then all the scores are averaged to a single value called 'Combined privacy rating'. 

The paper uses data from stats.grok.se which has stopped being updated as of January 2016 and the server is down at the moment. Our group chose to use an alternative data source from Wikipediatrend package in R (https://github.com/petermeissner/wikipediatrend) which allows user to specify page names, languages, start and end date of data and the library will return daily views for the articles.

![Sample keywords and their privacy score](img/privacy_score.png)


## 2.2 Methodology

The analysis will be done of different set of keywords such as terrism-related article which is expected to change and popular articles which is used as a baseline. The author concludes that there exists a change in trend if coefficients of the interaction terms are significant. Here is the example of regression analysis for terrorism-related articles.

![Original regression summary for terrorism-related keywords](img/terror_regression_summary.png)

The sample plots will be shown in the Replication Results section to compare with our results.

## 2.3 Criticism

### 2.3.1 Defining and removing outliers

Outliers are treated before performing further analysis in this study. There are two mains type of data that are considered to be outliers. The first reason is unual events, for example the media coverage about dispute between Hamas and Israel. The other method is removing outliers by considering z-score. Both are reasonable way to deal with outliers. However, removing out might cause another problems such as missing data. Moreover, there is no clear rule to identify the events like news and other exposures for all the keywords.

![Difference in regression results before and after removing outliers](img/outlier.png)

### 2.3.2 Privacy ratings: data collection and calculation

The first problem about data collection is the representation of the population (MTurk, Wikipedia, US Internet users). This issue is acknowledged by the author that the sample of people who did the survey have slightly lower incomes, slightly more male than female and use “websites and other online resources” for information more generally than the overall US population. The use of multiple proxies: Wikipedia as a representation of the internet usage and the opinion of MTurk users as public opinions might make the the result prone to more error.

The second problem about data is how the topics are presented to the subjects. There exists some neutral keywords like ‘recruitment’ and ‘terror’ which their contents in Wikipedia does not related with terrorism. The opinion or privacy rating will be less credible if only the keywords are presented to the subjects not the actual webpage.

Finally, the combined privacy rating is calculate by averaging ‘Government trouble’, ‘Browser delete’, ‘Privacy sensitive’, ‘Avoidance’ assumes that all the factors are equally importance which is difficult to prove the validity.

### 2.3.3 Result interpretation

Theinterpretation of results focus on the significance of coefficients, however it does not provide the sense of magnitude or direction of the change. For example a trend might change for increasing to highly increasing or decreasing and both would give significant results. Moreover, the overall trend might be dominated by few keywords. Our group comes up with the solution to this problem and performs an alternative analysis in the Per-keyword Analysis section.

## 2.4 Replication Results

```{r load data}
load("data/terrorism_data.RData")
load("data/infra_data.RData")
load("data/popular_data.RData")
```

### 2.4.1 Total views of terrorism-related keywords before and after the incident

```{r}
terrorism_data %>%
  mutate(before_after = ifelse(date < '2013-06-01', "Before_June_2013", "After_June_2013")) %>%
  group_by(before_after) %>%
  summarise(total_views = sum(views)) %>%
  ggplot(aes(x= factor(before_after, level = c("Before_June_2013", "After_June_2013")), y=total_views, width=0.5)) +
  scale_y_continuous(name="Total Views", labels = comma) +
  xlab("Time") +
  geom_text(aes(label=comma(total_views)), vjust=-0.3, color="black", size=3.5) +
  theme_bw(base_size = 10) +
  geom_bar(stat="identity") +
  ggtitle("Total views of terrorism-related keywords before and after the incident")
```

### 2.4.2 Linear model with interactions: Analysis and Plots


```{r }
lm_plot_topic <- function(input_df, gg_title){

df <- data.frame(input_df)
df <- df %>% 
  group_by(month=floor_date(date, "month")) %>%
  summarize(views=sum(views))
df$surveillence <- 'before'
df$surveillence[df$month >= '2013-06-01'] <- 'after'

model <- lm(views ~ month + surveillence + month*surveillence, data = df)
print(summary(model))


df$prediction <- predict(model, df)
df$se <- predict(model, df,
                      se.fit = TRUE)$se.fit
z.val <- qnorm(1 - (1 - 0.90)/2)
df$LoCI <- df$prediction - z.val * df$se
df$HiCI <- df$prediction + z.val * df$se

df$month <- ymd(df$month)

ggplot(df,
       aes(x = month,
           y = prediction)) +
  geom_smooth(aes(ymin = LoCI, 
                  ymax = HiCI,
                  color = surveillence),
              stat = "identity") +
  geom_point(data = df, aes(x=month, y = views)) +
  geom_vline(xintercept = as.Date('2013-06-01'), linetype = 2, colour = 'blue') +
  ylab('Views') +
  xlab('Time (monthly)') +
  scale_x_date(date_breaks = "6 month", labels = date_format("%Y-%b")) +
  scale_y_continuous(labels = comma) +
  ggtitle(gg_title)
}
```

![Original result for terrorism-related keywords](img/terror.png)

```{r}
lm_plot_topic(terrorism_data, 'Terrorism-related keywords trend before and after June 2013')
```

```{r}
lm_plot_topic(popular_data, 'Popular keywords trend before and after June 2013')
```

```{r}
lm_plot_topic(infra_data, 'Infrastructure security-related keywords trend before and after June 2013')
```

# 3. Extended Analysis

## 3.1 Longer Trend Analysis

## 3.2 Per-keyword Analysis

```{r}
lm_plot_keyword <- function(input_df, article_name, gg_title){

df <- data.frame(input_df)
df <- df %>% 
  group_by(article ,month=floor_date(date, "month")) %>%
  summarize(views=sum(views)) %>%
  filter(article == article_name)  

df$surveillence <- 'before'
df$surveillence[df$month >= '2013-06-01'] <- 'after'

model <- lm(views ~ month + surveillence + month*surveillence, data = df)
print(summary(model))


df$prediction <- predict(model, df)
df$se <- predict(model, df,
                      se.fit = TRUE)$se.fit
z.val <- qnorm(1 - (1 - 0.90)/2)
df$LoCI <- df$prediction - z.val * df$se
df$HiCI <- df$prediction + z.val * df$se

df$month <- ymd(df$month)

ggplot(df,
       aes(x = month,
           y = prediction)) +
  geom_smooth(aes(ymin = LoCI, 
                  ymax = HiCI,
                  color = surveillence),
              stat = "identity") +
  geom_point(data = df, aes(x=month, y = views)) +
  geom_vline(xintercept = as.Date('2013-06-01'), linetype = 2, colour = 'blue') +
  ylab('Views') +
  xlab('Time (monthly)') +
  scale_x_date(date_breaks = "6 month", labels = date_format("%Y-%b")) +
  scale_y_continuous(labels = comma) +
  ggtitle(gg_title)
}
```

```{r}
lm_plot_keyword(terrorism_data, 'al-qaeda', 'Trend for \'al-qaeda\' before and after June 2013')
```

```{r}
lm_plot_keyword(terrorism_data, 'terror', 'Trend for \'terror\' before and after June 2013')
```

```{r}
lm_plot_keyword(terrorism_data, 'recruitment', 'Trend for \'recruitment\' before and after June 2013')
```

## 3.3 Time-series Analysis

## 3.4 Trend Recovery

<!-- ```{r , echo=FALSE} -->

<!-- terrorism_topics <- c('Al-Qaeda', 'Terrorism', 'Terror', 'Environmental_terrorism', 'Eco-terrorism', 'Conventional_weapon', 'Weapons-grade', 'Dirty_bomb', 'Nuclear_enrichment', 'nuclear') -->

<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2015-12-31" -->
<!--   ) -->


<!-- save(trend_data, file = "terrorism_May_11.RData") -->
<!-- #plot(trend_data) -->

<!-- #trend_data %>% -->
<!-- #  group_by(article, month=floor_date(date, "month")) %>% -->
<!-- #  summarize(views=sum(views)) %>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point(aes(color = article)) -->

<!-- monthly_agg <- trend_data %>% -->
<!--   group_by(month=floor_date(date, "month")) %>% -->
<!--   summarize(views=sum(views)) -->
<!-- #%>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point() -->

<!-- monthly_agg$surveillence <- 'before' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2013-06-01'] <- 'after' -->

<!-- model <- lm(views ~ month + surveillence + month*surveillence, data = monthly_agg) -->
<!-- summary(model) -->

<!-- #plot(predict(model, monthly_agg)) -->

<!-- monthly_agg$prediction <- predict(model, monthly_agg) -->
<!-- monthly_agg$se <- predict(model, monthly_agg, -->
<!--                       se.fit = TRUE)$se.fit -->
<!-- z.val <- qnorm(1 - (1 - 0.90)/2) -->
<!-- monthly_agg$LoCI <- monthly_agg$prediction - z.val * monthly_agg$se -->
<!-- monthly_agg$HiCI <- monthly_agg$prediction + z.val * monthly_agg$se -->
<!-- #effect_plot(model, pred = view, interval = TRUE, plot.points = TRUE) -->

<!-- monthly_agg$month <- ymd(monthly_agg$month) -->

<!-- ggplot(monthly_agg, -->
<!--        aes(x = month, -->
<!--            y = prediction)) + -->
<!--   geom_smooth(aes(ymin = LoCI, -->
<!--                   ymax = HiCI, -->
<!--                   color = surveillence), -->
<!--               stat = "identity") + -->
<!--   geom_point(data = monthly_agg, aes(x=month, y = views)) + -->
<!--   geom_vline(xintercept = as.Date('2013-06-01'), linetype = 2, colour = 'blue') + -->
<!--   ylab('Views') + -->
<!--   xlab('Time (monthly)') + -->
<!--   scale_x_date(date_breaks = "6 month", labels = date_format("%Y-%b")) + -->
<!--   scale_y_continuous(labels = comma) -->
<!-- ``` -->
<!-- ```{r , echo=FALSE} -->


<!-- terrorism_topics <- c('Al-Qaeda', 'Terrorism', 'Terror', 'Environmental_terrorism', 'Eco-terrorism', 'Conventional_weapon', 'Weapons-grade', 'Dirty_bomb', 'Nuclear_enrichment', 'nuclear') -->

<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2015-12-31" -->
<!--   ) -->



<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2019-04-10" -->
<!--   ) -->


<!-- #plot(trend_data) -->

<!-- #trend_data %>% -->
<!-- #  group_by(article, month=floor_date(date, "month")) %>% -->
<!-- #  summarize(views=sum(views)) %>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point(aes(color = article)) -->

<!-- monthly_agg <- trend_data %>% -->
<!--   group_by(month=floor_date(date, "month")) %>% -->
<!--   summarize(views=sum(views)) -->
<!-- #%>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point() -->

<!-- monthly_agg$surveillence <- 'before' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2013-06-01'] <- 'after' -->

<!-- model <- lm(views ~ month + surveillence + month*surveillence, data = monthly_agg) -->
<!-- summary(model) -->

<!-- #plot(predict(model, monthly_agg)) -->

<!-- monthly_agg$prediction <- predict(model, monthly_agg) -->
<!-- monthly_agg$se <- predict(model, monthly_agg, -->
<!--                       se.fit = TRUE)$se.fit -->
<!-- z.val <- qnorm(1 - (1 - 0.90)/2) -->
<!-- monthly_agg$LoCI <- monthly_agg$prediction - z.val * monthly_agg$se -->
<!-- monthly_agg$HiCI <- monthly_agg$prediction + z.val * monthly_agg$se -->
<!-- #effect_plot(model, pred = view, interval = TRUE, plot.points = TRUE) -->

<!-- monthly_agg$month <- ymd(monthly_agg$month) -->

<!-- ggplot(monthly_agg, -->
<!--        aes(x = month, -->
<!--            y = prediction)) + -->
<!--   geom_smooth(aes(ymin = LoCI, -->
<!--                   ymax = HiCI, -->
<!--                   color = surveillence), -->
<!--               stat = "identity") + -->
<!--   geom_point(data = monthly_agg, aes(x=month, y = views)) + -->
<!--   geom_vline(xintercept = as.Date('2013-06-01'), linetype = 2, colour = 'blue') + -->
<!--   geom_vline(xintercept = as.Date('2015-12-31'), linetype = 2, colour = 'blue') + -->
<!--   ylab('Views') + -->
<!--   xlab('Time (monthly)') + -->
<!--   scale_x_date(date_breaks = "6 month", labels = date_format("%Y-%b")) + -->
<!--   scale_y_continuous(labels = comma) -->

<!-- ``` -->
<!-- ```{r , echo=FALSE} -->

<!-- terrorism_topics <- c('Al-Qaeda', 'Terrorism', 'Terror', 'Environmental_terrorism', 'Eco-terrorism', 'Conventional_weapon', 'Weapons-grade', 'Dirty_bomb', 'Nuclear_enrichment', 'nuclear') -->

<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2015-12-31" -->
<!--   ) -->



<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2019-04-10" -->
<!--   ) -->


<!-- #plot(trend_data) -->

<!-- #trend_data %>% -->
<!-- #  group_by(article, month=floor_date(date, "month")) %>% -->
<!-- #  summarize(views=sum(views)) %>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point(aes(color = article)) -->

<!-- monthly_agg <- trend_data %>% -->
<!--   group_by(month=floor_date(date, "month")) %>% -->
<!--   summarize(views=sum(views)) -->
<!-- #%>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point() -->

<!-- monthly_agg$surveillence <- 'before' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2013-06-01'] <- 'after' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2014-12-3'] <- 'after_after' -->

<!-- model <- lm(views ~ month + surveillence + month*surveillence, data = monthly_agg) -->
<!-- summary(model) -->

<!-- #plot(predict(model, monthly_agg)) -->

<!-- monthly_agg$prediction <- predict(model, monthly_agg) -->
<!-- monthly_agg$se <- predict(model, monthly_agg, -->
<!--                       se.fit = TRUE)$se.fit -->
<!-- z.val <- qnorm(1 - (1 - 0.90)/2) -->
<!-- monthly_agg$LoCI <- monthly_agg$prediction - z.val * monthly_agg$se -->
<!-- monthly_agg$HiCI <- monthly_agg$prediction + z.val * monthly_agg$se -->
<!-- #effect_plot(model, pred = view, interval = TRUE, plot.points = TRUE) -->

<!-- monthly_agg$month <- ymd(monthly_agg$month) -->

<!-- ggplot(monthly_agg, -->
<!--        aes(x = month, -->
<!--            y = prediction)) + -->
<!--   geom_smooth(aes(ymin = LoCI, -->
<!--                   ymax = HiCI, -->
<!--                   color = surveillence), -->
<!--               stat = "identity") + -->
<!--   geom_point(data = monthly_agg, aes(x=month, y = views)) + -->
<!--   geom_vline(xintercept = as.Date('2013-06-01'), linetype = 2, colour = 'blue') + -->
<!--   geom_vline(xintercept = as.Date('2014-12-3'), linetype = 2, colour = 'blue') + -->
<!--   ylab('Views') + -->
<!--   xlab('Time (monthly)') + -->
<!--   scale_x_date(date_breaks = "6 month", labels = date_format("%Y-%b")) + -->
<!--    theme_bw(base_size = 5) + -->
<!--   scale_y_continuous(labels = comma) -->


<!-- ``` -->



<!-- ```{r , echo=FALSE} -->


<!-- terrorism_topics <- c('Al-Qaeda', 'Terrorism', 'Terror', 'Environmental_terrorism', 'Eco-terrorism', 'Conventional_weapon', 'Weapons-grade', 'Dirty_bomb', 'Nuclear_enrichment', 'nuclear') -->

<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2015-12-31" -->
<!--   ) -->



<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2019-04-10" -->
<!--   ) -->


<!-- #plot(trend_data) -->

<!-- #trend_data %>% -->
<!-- #  group_by(article, month=floor_date(date, "month")) %>% -->
<!-- #  summarize(views=sum(views)) %>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point(aes(color = article)) -->

<!-- monthly_agg <- trend_data %>% -->
<!--   group_by(month=floor_date(date, "month")) %>% -->
<!--   summarize(views=sum(views)) -->
<!-- #%>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point() -->

<!-- monthly_agg$surveillence <- 'before' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2013-06-01'] <- 'after' -->

<!-- model <- lm(views ~ month + surveillence + month*surveillence, data = monthly_agg) -->
<!-- summary(model) -->

<!-- #plot(predict(model, monthly_agg)) -->

<!-- monthly_agg$prediction <- predict(model, monthly_agg) -->
<!-- monthly_agg$se <- predict(model, monthly_agg, -->
<!--                       se.fit = TRUE)$se.fit -->
<!-- z.val <- qnorm(1 - (1 - 0.90)/2) -->
<!-- monthly_agg$LoCI <- monthly_agg$prediction - z.val * monthly_agg$se -->
<!-- monthly_agg$HiCI <- monthly_agg$prediction + z.val * monthly_agg$se -->
<!-- #effect_plot(model, pred = view, interval = TRUE, plot.points = TRUE) -->

<!-- monthly_agg$month <- ymd(monthly_agg$month) -->

<!-- ggplot(monthly_agg, -->
<!--        aes(x = month, -->
<!--            y = views)) + -->
<!--   geom_smooth(aes(ymin = 0, -->
<!--                   ymax = 0, -->
<!--                   color = surveillence), -->
<!--               stat = "identity") + -->
<!--   geom_point(data = monthly_agg, aes(x=month, y = views)) + -->
<!--   geom_vline(xintercept = as.Date('2013-06-01'), linetype = 2, colour = 'blue') + -->
<!--   geom_vline(xintercept = as.Date('2015-12-31'), linetype = 2, colour = 'blue') + -->
<!--   ylab('Views') + -->
<!--   xlab('Time (monthly)') + -->
<!--   scale_x_date(date_breaks = "6 month", labels = date_format("%Y-%b")) + -->
<!--   scale_y_continuous(labels = comma) -->

<!-- ``` -->



<!-- ```{r , echo=FALSE} -->


<!-- terrorism_topics <- c('Al-Qaeda', 'Terrorism', 'Terror', 'Environmental_terrorism', 'Eco-terrorism', 'Conventional_weapon', 'Weapons-grade', 'Dirty_bomb', 'Nuclear_enrichment', 'nuclear') -->

<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2015-12-31" -->
<!--   ) -->



<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2019-04-10" -->
<!--   ) -->


<!-- #plot(trend_data) -->

<!-- #trend_data %>% -->
<!-- #  group_by(article, month=floor_date(date, "month")) %>% -->
<!-- #  summarize(views=sum(views)) %>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point(aes(color = article)) -->

<!-- monthly_agg <- trend_data %>% -->
<!--   group_by(month=floor_date(date, "month")) %>% -->
<!--   summarize(views=sum(views)) -->
<!-- #%>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point() -->

<!-- monthly_agg$surveillence <- 'before' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2013-06-01'] <- 'after' -->

<!-- model <- lm(views ~ month + surveillence + month*surveillence, data = monthly_agg) -->
<!-- summary(model) -->

<!-- #plot(predict(model, monthly_agg)) -->

<!-- monthly_agg$prediction <- predict(model, monthly_agg) -->
<!-- monthly_agg$se <- predict(model, monthly_agg, -->
<!--                       se.fit = TRUE)$se.fit -->
<!-- z.val <- qnorm(1 - (1 - 0.90)/2) -->
<!-- monthly_agg$LoCI <- monthly_agg$prediction - z.val * monthly_agg$se -->
<!-- monthly_agg$HiCI <- monthly_agg$prediction + z.val * monthly_agg$se -->
<!-- #effect_plot(model, pred = view, interval = TRUE, plot.points = TRUE) -->

<!-- monthly_agg$month <- ymd(monthly_agg$month) -->

<!-- ggplot(monthly_agg, -->
<!--        aes(x = month, -->
<!--            y = views)) + -->

<!--   geom_point(data = monthly_agg, aes(x=month, y = views)) + -->
<!--   geom_vline(xintercept = as.Date('2013-06-01'), linetype = 2, colour = 'blue') + -->
<!--   geom_vline(xintercept = as.Date('2014-12-31'), linetype = 2, colour = 'blue') + -->
<!--   ylab('Views') + -->
<!--   xlab('Time (monthly)') + -->
<!--   scale_x_date(date_breaks = "6 month", labels = date_format("%Y-%b")) + -->
<!--    theme_bw(base_size = 5) + -->
<!--   scale_y_continuous(labels = comma) -->

<!-- ``` -->




<!-- ```{r , echo=FALSE} -->


<!-- terrorism_topics <- c('Al-Qaeda', 'Terrorism', 'Terror', 'Environmental_terrorism', 'Eco-terrorism', 'Conventional_weapon', 'Weapons-grade', 'Dirty_bomb', 'Nuclear_enrichment', 'nuclear') -->

<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2015-12-31" -->
<!--   ) -->



<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2019-04-10" -->
<!--   ) -->


<!-- #plot(trend_data) -->

<!-- #trend_data %>% -->
<!-- #  group_by(article, month=floor_date(date, "month")) %>% -->
<!-- #  summarize(views=sum(views)) %>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point(aes(color = article)) -->

<!-- monthly_agg <- trend_data %>% -->
<!--   group_by(month=floor_date(date, "month")) %>% -->
<!--   summarize(views=sum(views)) -->
<!-- #%>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point() -->

<!-- monthly_agg$surveillence <- 'before' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2013-06-01'] <- 'after' -->

<!-- model <- lm(views ~ month + surveillence + month*surveillence, data = monthly_agg) -->


<!-- #plot(predict(model, monthly_agg)) -->

<!-- monthly_agg$prediction <- predict(model, monthly_agg) -->
<!-- monthly_agg$se <- predict(model, monthly_agg, -->
<!--                       se.fit = TRUE)$se.fit -->
<!-- z.val <- qnorm(1 - (1 - 0.90)/2) -->
<!-- monthly_agg$LoCI <- monthly_agg$prediction - z.val * monthly_agg$se -->
<!-- monthly_agg$HiCI <- monthly_agg$prediction + z.val * monthly_agg$se -->
<!-- #effect_plot(model, pred = view, interval = TRUE, plot.points = TRUE) -->

<!-- monthly_agg$month <- ymd(monthly_agg$month) -->


<!-- #fit <- lm(views ~ month + I(month^2), data = monthly_agg) -->

<!-- #plot(views~month) -->
<!-- #points(month, fitted(fit), col='red', pch=20) -->

<!-- ggplot(monthly_agg, -->
<!--        aes(x = month, -->
<!--            y = views)) + geom_point()+stat_smooth(se=T)+ -->

<!--   geom_point(data = monthly_agg, aes(x=month, y = views)) + -->
<!--   geom_vline(xintercept = as.Date('2013-06-01'), linetype = 2, colour = 'blue') + -->
<!--   geom_vline(xintercept = as.Date('2015-12-31'), linetype = 2, colour = 'blue') + -->
<!--   ylab('Views') + -->
<!--   xlab('Time (monthly)') + -->
<!--   scale_x_date(date_breaks = "6 month", labels = date_format("%Y-%b")) + -->
<!--   scale_y_continuous(labels = comma) -->


<!-- ``` -->






<!-- ```{r , echo=FALSE} -->


<!-- terrorism_topics <- c('Al-Qaeda', 'Terrorism', 'Terror', 'Environmental_terrorism', 'Eco-terrorism', 'Conventional_weapon', 'Weapons-grade', 'Dirty_bomb', 'Nuclear_enrichment', 'nuclear') -->

<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2015-12-31" -->
<!--   ) -->



<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2019-04-10" -->
<!--   ) -->


<!-- #plot(trend_data) -->

<!-- #trend_data %>% -->
<!-- #  group_by(article, month=floor_date(date, "month")) %>% -->
<!-- #  summarize(views=sum(views)) %>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point(aes(color = article)) -->

<!-- monthly_agg <- trend_data %>% -->
<!--   group_by(month=floor_date(date, "month")) %>% -->
<!--   summarize(views=sum(views)) -->
<!-- #%>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point() -->

<!-- monthly_agg$surveillence <- 'before' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2013-06-01'] <- 'after' -->

<!-- model <- lm(views ~ month + surveillence + month*surveillence, data = monthly_agg) -->


<!-- #plot(predict(model, monthly_agg)) -->

<!-- monthly_agg$prediction <- predict(model, monthly_agg) -->
<!-- monthly_agg$se <- predict(model, monthly_agg, -->
<!--                       se.fit = TRUE)$se.fit -->
<!-- z.val <- qnorm(1 - (1 - 0.90)/2) -->
<!-- monthly_agg$LoCI <- monthly_agg$prediction - z.val * monthly_agg$se -->
<!-- monthly_agg$HiCI <- monthly_agg$prediction + z.val * monthly_agg$se -->
<!-- #effect_plot(model, pred = view, interval = TRUE, plot.points = TRUE) -->

<!-- monthly_agg$month <- ymd(monthly_agg$month) -->


<!-- #fit <- lm(views ~ month + I(month^2), data = monthly_agg) -->

<!-- #plot(views~month) -->
<!-- #points(month, fitted(fit), col='red', pch=20) -->

<!-- ggplot(monthly_agg, -->
<!--        aes(x = month, -->
<!--            y = views)) + geom_point()+stat_smooth(method="loess", se=F)+ -->

<!--   geom_point(data = monthly_agg, aes(x=month, y = views)) + -->
<!--   geom_vline(xintercept = as.Date('2013-06-01'), linetype = 2, colour = 'blue') + -->
<!--   geom_vline(xintercept = as.Date('2015-12-31'), linetype = 2, colour = 'blue') + -->
<!--   ylab('Views') + -->
<!--   xlab('Time (monthly)') + -->
<!--   scale_x_date(date_breaks = "6 month", labels = date_format("%Y-%b")) + -->
<!--   scale_y_continuous(labels = comma) -->


<!-- ``` -->




<!-- ```{r , echo=FALSE} -->


<!-- terrorism_topics <- c('Al-Qaeda', 'Terrorism', 'Terror', 'Environmental_terrorism', 'Eco-terrorism', 'Conventional_weapon', 'Weapons-grade', 'Dirty_bomb', 'Nuclear_enrichment', 'nuclear') -->

<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2015-12-31" -->
<!--   ) -->



<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2019-04-10" -->
<!--   ) -->


<!-- #plot(trend_data) -->

<!-- #trend_data %>% -->
<!-- #  group_by(article, month=floor_date(date, "month")) %>% -->
<!-- #  summarize(views=sum(views)) %>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point(aes(color = article)) -->

<!-- monthly_agg <- trend_data %>% -->
<!--   group_by(month=floor_date(date, "month")) %>% -->
<!--   summarize(views=sum(views)) -->
<!-- #%>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point() -->

<!-- monthly_agg$surveillence <- 'before' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2013-06-01'] <- 'after' -->

<!-- model <- lm(views ~ month + surveillence + month*surveillence, data = monthly_agg) -->


<!-- #plot(predict(model, monthly_agg)) -->

<!-- monthly_agg$prediction <- predict(model, monthly_agg) -->
<!-- monthly_agg$se <- predict(model, monthly_agg, -->
<!--                       se.fit = TRUE)$se.fit -->
<!-- z.val <- qnorm(1 - (1 - 0.90)/2) -->
<!-- monthly_agg$LoCI <- monthly_agg$prediction - z.val * monthly_agg$se -->
<!-- monthly_agg$HiCI <- monthly_agg$prediction + z.val * monthly_agg$se -->
<!-- #effect_plot(model, pred = view, interval = TRUE, plot.points = TRUE) -->

<!-- monthly_agg$month <- ymd(monthly_agg$month) -->


<!-- #fit <- lm(views ~ month + I(month^2), data = monthly_agg) -->

<!-- #plot(views~month) -->
<!-- #points(month, fitted(fit), col='red', pch=20) -->
<!-- monthly_agg$month <- as.numeric(monthly_agg$month) -->
<!-- fit <- lm(views~poly(month,5,raw=TRUE),monthly_agg) -->
<!-- plot(views~month,monthly_agg) -->
<!-- curve(predict(fit,newdata=data.frame(month=x)),add=T) -->
<!-- ``` -->





<!-- ```{r , echo=FALSE} -->


<!-- terrorism_topics <- c('Al-Qaeda', 'Terrorism', 'Terror', 'Environmental_terrorism', 'Eco-terrorism', 'Conventional_weapon', 'Weapons-grade', 'Dirty_bomb', 'Nuclear_enrichment', 'nuclear') -->

<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2015-12-31" -->
<!--   ) -->



<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2019-04-10" -->
<!--   ) -->


<!-- #plot(trend_data) -->

<!-- #trend_data %>% -->
<!-- #  group_by(article, month=floor_date(date, "month")) %>% -->
<!-- #  summarize(views=sum(views)) %>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point(aes(color = article)) -->

<!-- monthly_agg <- trend_data %>% -->
<!--   group_by(month=floor_date(date, "month")) %>% -->
<!--   summarize(views=sum(views)) -->
<!-- #%>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point() -->

<!-- monthly_agg$surveillence <- 'before' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2013-06-01'] <- 'after' -->

<!-- model <- lm(views ~ month + surveillence + month*surveillence, data = monthly_agg) -->


<!-- #plot(predict(model, monthly_agg)) -->

<!-- monthly_agg$prediction <- predict(model, monthly_agg) -->
<!-- monthly_agg$se <- predict(model, monthly_agg, -->
<!--                       se.fit = TRUE)$se.fit -->
<!-- z.val <- qnorm(1 - (1 - 0.90)/2) -->
<!-- monthly_agg$LoCI <- monthly_agg$prediction - z.val * monthly_agg$se -->
<!-- monthly_agg$HiCI <- monthly_agg$prediction + z.val * monthly_agg$se -->
<!-- #effect_plot(model, pred = view, interval = TRUE, plot.points = TRUE) -->

<!-- monthly_agg$month <- ymd(monthly_agg$month) -->


<!-- #fit <- lm(views ~ month + I(month^2), data = monthly_agg) -->

<!-- #plot(views~month) -->
<!-- #points(month, fitted(fit), col='red', pch=20) -->

<!-- ggplot(monthly_agg, -->
<!--        aes(x = month, -->
<!--            y = views)) + geom_point()+stat_smooth( se=T)+ -->

<!--   geom_point(data = monthly_agg, aes(x=month, y = views)) + -->
<!--   geom_vline(xintercept = as.Date('2013-06-01'), linetype = 2, colour = 'blue') + -->
<!--   geom_vline(xintercept = as.Date('2014-12-3'), linetype = 2, colour = 'blue') + -->
<!--   ylab('Views') + -->
<!--   xlab('Time (monthly)') + -->
<!--   scale_x_date(date_breaks = "6 month", labels = date_format("%Y-%b")) + -->
<!--   theme_bw(base_size = 5) + -->
<!--   scale_y_continuous(labels = comma) -->


<!-- ``` -->



<!-- ```{r , echo=FALSE} -->


<!-- terrorism_topics <- c('Al-Qaeda', 'Terrorism', 'Terror', 'Environmental_terrorism', 'Eco-terrorism', 'Conventional_weapon', 'Weapons-grade', 'Dirty_bomb', 'Nuclear_enrichment', 'nuclear') -->

<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2015-12-31" -->
<!--   ) -->



<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2019-04-10" -->
<!--   ) -->


<!-- #plot(trend_data) -->

<!-- #trend_data %>% -->
<!-- #  group_by(article, month=floor_date(date, "month")) %>% -->
<!-- #  summarize(views=sum(views)) %>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point(aes(color = article)) -->

<!-- monthly_agg <- trend_data %>% -->
<!--   group_by(month=floor_date(date, "month")) %>% -->
<!--   summarize(views=sum(views)) -->
<!-- #%>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point() -->

<!-- monthly_agg$surveillence <- 'before' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2013-06-01'] <- 'after' -->

<!-- model <- lm(views ~ month + surveillence + month*surveillence, data = monthly_agg) -->


<!-- #plot(predict(model, monthly_agg)) -->

<!-- monthly_agg$prediction <- predict(model, monthly_agg) -->
<!-- monthly_agg$se <- predict(model, monthly_agg, -->
<!--                       se.fit = TRUE)$se.fit -->
<!-- z.val <- qnorm(1 - (1 - 0.90)/2) -->
<!-- monthly_agg$LoCI <- monthly_agg$prediction - z.val * monthly_agg$se -->
<!-- monthly_agg$HiCI <- monthly_agg$prediction + z.val * monthly_agg$se -->
<!-- #effect_plot(model, pred = view, interval = TRUE, plot.points = TRUE) -->

<!-- monthly_agg$month <- ymd(monthly_agg$month) -->




<!-- #fit <- lm(views ~ month + I(month^2), data = monthly_agg) -->

<!-- #plot(views~month) -->
<!-- #points(month, fitted(fit), col='red', pch=20) -->
<!-- monthly_agg$month <- as.numeric(monthly_agg$month) -->
<!-- fit <- lm(views~poly(month,5,raw=TRUE),monthly_agg) -->
<!-- plot(views~month,monthly_agg) -->
<!-- curve(predict(fit,newdata=data.frame(month=x)),add=T) -->
<!-- ``` -->



<!-- ```{r , echo=FALSE} -->

<!-- terrorism_topics <- c('Al-Qaeda', 'Terrorism', 'Terror', 'Environmental_terrorism', 'Eco-terrorism', 'Conventional_weapon', 'Weapons-grade', 'Dirty_bomb', 'Nuclear_enrichment', 'nuclear') -->

<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2014-12-3" -->
<!--   ) -->

<!-- #plot(trend_data) -->

<!-- #trend_data %>% -->
<!-- #  group_by(article, month=floor_date(date, "month")) %>% -->
<!-- #  summarize(views=sum(views)) %>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point(aes(color = article)) -->

<!-- monthly_agg <- trend_data %>% -->
<!--   group_by(month=floor_date(date, "month")) %>% -->
<!--   summarize(views=sum(views)) -->
<!-- #%>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point() -->

<!-- monthly_agg$surveillence <- 'before' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2013-06-01'] <- 'after' -->

<!-- model <- lm(views ~ month + surveillence + month*surveillence, data = monthly_agg) -->
<!-- summary(model) -->

<!-- #plot(predict(model, monthly_agg)) -->

<!-- monthly_agg$prediction <- predict(model, monthly_agg) -->
<!-- monthly_agg$se <- predict(model, monthly_agg, -->
<!--                       se.fit = TRUE)$se.fit -->
<!-- z.val <- qnorm(1 - (1 - 0.90)/2) -->
<!-- monthly_agg$LoCI <- monthly_agg$prediction - z.val * monthly_agg$se -->
<!-- monthly_agg$HiCI <- monthly_agg$prediction + z.val * monthly_agg$se -->
<!-- #effect_plot(model, pred = view, interval = TRUE, plot.points = TRUE) -->

<!-- monthly_agg$month <- ymd(monthly_agg$month) -->

<!-- plot_before <- monthly_agg$views[monthly_agg$month < '2013-06-01'] -->
<!-- plot_after <- monthly_agg$views[monthly_agg$month >= '2013-06-01'] -->

<!-- plot_before <- sum(plot_before) -->
<!-- plot_after <- sum(plot_after) -->

<!-- df <- data.frame(Date1=c("After_June_2013", "Before_June_2013"), -->
<!--                 Total_Views=c(plot_after, plot_before)) -->
<!-- df$Date <- factor(df$Date1, c("Before_June_2013", "After_June_2013")) -->
<!-- ggplot(data=df, aes(x=Date, y=Total_Views, width=0.2)) + -->
<!--   scale_y_continuous(name="Total Views", labels = comma) + -->
<!--   theme_bw(base_size = 10) + -->
<!--   geom_bar(stat="identity") -->


<!-- ``` -->




<!-- ```{r , echo=FALSE} -->

<!-- terrorism_topics <- c('Al-Qaeda', 'Terrorism', 'Terror', 'Environmental_terrorism', 'Eco-terrorism', 'Conventional_weapon', 'Weapons-grade', 'Dirty_bomb', 'Nuclear_enrichment', 'nuclear') -->

<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2015-12-31" -->
<!--   ) -->



<!-- trend_data <- -->
<!--   wp_trend( -->
<!--     page = terrorism_topics, -->
<!--     lang = "en", -->
<!--     from = "2011-12-01", -->
<!--     to   = "2019-04-10" -->
<!--   ) -->


<!-- #plot(trend_data) -->

<!-- #trend_data %>% -->
<!-- #  group_by(article, month=floor_date(date, "month")) %>% -->
<!-- #  summarize(views=sum(views)) %>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point(aes(color = article)) -->

<!-- monthly_agg <- trend_data %>% -->
<!--   group_by(month=floor_date(date, "month")) %>% -->
<!--   summarize(views=sum(views)) -->
<!-- #%>% -->
<!-- #  ggplot(aes(x = month, y = views)) + -->
<!-- #  geom_point() -->

<!-- monthly_agg$surveillence <- 'before' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2013-06-01'] <- 'after' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2014-12-3'] <- 'after_after' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2016-06-3'] <- 'after_after_after' -->
<!-- monthly_agg$surveillence[monthly_agg$month >= '2016-06-3'] <- 'after_after_after_after' -->

<!-- model <- lm(views ~ month + surveillence + month*surveillence, data = monthly_agg) -->
<!-- summary(model) -->

<!-- #plot(predict(model, monthly_agg)) -->

<!-- monthly_agg$prediction <- predict(model, monthly_agg) -->
<!-- monthly_agg$se <- predict(model, monthly_agg, -->
<!--                       se.fit = TRUE)$se.fit -->
<!-- z.val <- qnorm(1 - (1 - 0.90)/2) -->
<!-- monthly_agg$LoCI <- monthly_agg$prediction - z.val * monthly_agg$se -->
<!-- monthly_agg$HiCI <- monthly_agg$prediction + z.val * monthly_agg$se -->
<!-- #effect_plot(model, pred = view, interval = TRUE, plot.points = TRUE) -->

<!-- monthly_agg$month <- ymd(monthly_agg$month) -->

<!-- ggplot(monthly_agg, -->
<!--        aes(x = month, -->
<!--            y = prediction)) + -->
<!--   geom_smooth(aes(ymin = LoCI, -->
<!--                   ymax = HiCI, -->
<!--                   color = surveillence), -->
<!--               stat = "identity") + -->
<!--   geom_point(data = monthly_agg, aes(x=month, y = views)) + -->
<!--   geom_vline(xintercept = as.Date('2013-06-01'), linetype = 2, colour = 'blue') + -->
<!--   geom_vline(xintercept = as.Date('2014-12-3'), linetype = 2, colour = 'blue') + -->
<!--   geom_vline(xintercept = as.Date('2016-06-3'), linetype = 2, colour = 'blue') + -->
<!--   geom_vline(xintercept = as.Date('2016-06-3'), linetype = 2, colour = 'blue') + -->
<!--   ylab('Views') + -->
<!--   xlab('Time (monthly)') + -->
<!--   scale_x_date(date_breaks = "6 month", labels = date_format("%Y-%b")) + -->
<!--    theme_bw(base_size = 5) + -->
<!--   scale_y_continuous(labels = comma) -->


<!-- ``` -->


The following is a list of all packages used to generate these results. (Leave at very end of file.)

```{r}
sessionInfo()
```